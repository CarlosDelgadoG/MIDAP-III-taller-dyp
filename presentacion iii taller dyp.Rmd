---
title: "Modeling PHQ-9 Scores in Chilean Longitudinal Social Survey"
author: "Carlos Delgado G."
date: "13-11-2021"
output:
  ioslides_presentation:
    css: css_presentacion.css


---



```{r setup, include=FALSE}
library(tidyverse)
library(data.table)
library(pscl)
knitr::opts_chunk$set(echo = FALSE,message = FALSE,warning = FALSE)
```

```{r}
#Recodificaciones
source('Recodificaciones.R', encoding = 'UTF-8', echo=FALSE)
source('funciones midap.R', encoding = 'UTF-8', echo=FALSE)
```

## About the research

- **Interest** Asses which gruops of people have the more severe and persistent depressive symptoms
- **Research goal** To model the longitudinal aspect of PHQ-9 Scores in ELSOC participants
- **Metodology** Generalized linear mixed effects models
- **Current state** Trying different models for the first year of the study
- **Presentation** Count models that take into account the excess of zeros.

## About the data

- [ELSOC-COES](https://coes.cl/encuesta-panel/) Chilean Longitudinal Social Survey. 5 year panel data since, 2016. Aims to be representative of urban chilean population
- More than 300 variables from different modules: *"Territory"*, *"Social attitudes and networks"*, *"Citizenship and Democracy"*,*"Inequality and Legitimacy"*, *"Social Conflict"*, *"Health and Wellbeing"*, *"Sociodemographic"*.
- **Health and Wellbeing**: Life satisfaction, PHQ-9, Stressors, recient health issues, substances use, support networks, acces to health systems, BMI. 

## About PHQ-9


## PHQ-9 Items (1-3)

Over the last 2 weeks, how often have you been bothered
by any of the following problems? 

```{r}
grafo_phq(c("s11_01_rec","s11_02_rec","s11_03_rec"),c("Little interest in things","Feeling down","Trouble with sleep"))
```

## PHQ-9 Items (4-6)

Over the last 2 weeks, how often have you been bothered
by any of the following problems? 

```{r}
grafo_phq(c("s11_04_rec","s11_05_rec","s11_06_rec"),c("Tired or little energy","Poor appetite or overeating","Feeling bad about yourself"))
```

## PHQ-9 Items (7-9)

Over the last 2 weeks, how often have you been bothered
by any of the following problems? 

```{r}
grafo_phq(c("s11_07_rec","s11_08_rec","s11_09_rec"),c("Trouble concentrating","Moving slowly or restless","Thoughts of hurting yourself"))
```


## Aggregated PHQ-9 score {.smaller}

For each of the 9 items recode "Not at all" as 0, "Several days" as 1, "More than half the days" as 2, and "Nearly everyday" as 3. Then sum all items. The result is a score that ranges from 0 to 27.

```{r}
ggplot(elsoc_2016,aes(x=s11_phq9))+
  geom_bar(fill="cornflowerblue",color="white")+
  labs(x="PHQ-9 Score",
       y="Frecuency")+
  theme_classic()
```

## Differences in depressive sintoms (1)

```{r}
phq_boxplot("m0_sexo_fac","PHQ-9 Scores by gender",etiq = c("Male", "Female"))
```

## Differences in depressive sintoms (2)

```{r}
phq_boxplot("m02_fac", etiq = c("Employed","Domestic Labour","Retired","Unemployed","Other Categories"))
```

## Differences in depressive sintoms (3)
```{r}
phq_boxplot("s_imc_fac",etiq = c("Normal","Overweight","Obese"))
```

## Differences in depressive sintoms (4)
```{r}
phq_boxplot("s08_fac",etiq = c("Non smoker","Smoker"))
```

## Differences in depressive sintoms (5)
```{r}
phq_boxplot("s01_fac",etiq = c("Unsatisfied","Neither satisfied nor unsatisfied","Satisfied"))
```


## Modeling approaches for discrete over-disperse data {.smaller}

<div style="float: left; width: 30%;">
- Against the normal model
- We want count probabilities
- The Poisson Model
- Over disperse data
- Excess of ceros
</div>

<div style="float: right; width: 70%;">

```{r,fig.width=6}
ggplot(elsoc_2016,aes(x=s11_phq9))+
  geom_bar(fill="cornflowerblue",color="white")+
  labs(x="PHQ-9 Score",
       y="Frecuency")+
  theme_classic()
```

</div>

## Zero-inflated Negative Binomial (ZINB) Regression

- You model two separate processes:
-     PHQ-9 score > 1
-     Having a 0 PHQ-9 score

## Toy example ZINB Regression {.smaller}

- **Gender**: Categorical: *"Male"*, *"Female"*.
- **Stressors**: Number of vital events in the last year (death of family member, illnes, Job layoff, etc). Numeric 0-8.
- **Age**: Numeric 18-88.
- **Smoker**: Categorical: *"Non Smoker"*, *"Smoker"*.
- **Body Mass Index (BMI)**: Continuous, median value 26,83.
- **Life Satisfaction**: Categorical: *"Not Satisfied"* (Negative),*"Neither satisfied nor dissatisfied"* (Neutral), *"Satisfied"* (Positive).

## Modeling PHQ-9 Scores by ZINB regression {.reduced}


```{r}
mod_zinb<- zeroinfl(s11_phq9~s_imc+m0_sexo_fac+s13_estresores+m0_edad+s01_fac+s08_fac,data = elsoc_2016,dist="negbin")

```

```{r,results='asis',fig.height=5}
texreg::htmlreg(mod_zinb,single.row=TRUE,
                custom.coef.names=c("Count: Intercept","Count: BMI","Count: Female","Count: Stressors",
                                                             "Count: Age","Count: Neutral Satisfaction","Count: Positive Satisfaction",
                                                             "Count: Smoker","Count: Over dispersion parameter",
                                                             "Zero: Intercept","Zero: BMI","Zero: Female","Zero: Stressors",
                                                             "Zero: Age","Zero: Neutral Satisfaction","Zero: Positive Satisfaction",
                                                             "Zero: Smoker"),
                custom.model.name="Zero-Inflated Negative Binomial Regression")
```

## Coefficients Interpretation {.smaller}

```{r}
exp_coef<- exp(coefficients(mod_zinb))
tabla_coef <- tibble("Variable"=unique(gsub(x=names(exp_coef),pattern = "count_|zero_",replace="")),
       "Count"=matrix(exp(coefficients(mod_zinb)),ncol = 2)[,1],
       "Zero"=matrix(exp(coefficients(mod_zinb)),ncol = 2)[,2])
tabla_coef$Variable <- c("Intercept","BMI","Female","Stressors","Age","Neutral Satisfaction","Positive Satisfaction","Smoker")
  
knitr::kable(tabla_coef,digits = 4)
```

## Count Effects in PHQ-9 Scores

```{r}
grafo_eff("Count")
```

## Zero effects in PHQ-9 Scores

```{r}
grafo_eff("Zero")
```

## What does that mean? Count part

- A unit increase in **BMI** increases the mean phq-9 score by a factor of 1%. 
- **Female** respondents have an increase un phq-9 score by a factor of 29%. 
- Each **stresor** event that the respondandt has, its relatedof an increase of the mean phq-9 socre by a factor of 14%.
- **Age** and being an **Smoker** are not statistical significant for predicting phq-9 scores.


## What does that mean? Zero part

- Being **Female** decreases by a factor of 46% of not having any symptoms (a zero score).
- Each **stressor** in the last year of the respondent decreasess by a factor of  40%.
- **Positive** life satisfaction increases the chances by a factor of 2.36 more than base line (Being **"Unsatisfied"**).
- **BMI**, **Neutral satisfaction** and **Smoker** are not relevant for predicting zero counts.


## Future directions

- Assesing binomial
- Adding the longitudinal 
- Variable selection
- Controlling missing data, adding sample weights, control panel attrition. 

## I'm happy to hear about

- Applications of PHQ-9
- Relevant factors in depressive symptoms
- Mental Health in Chile (Specially data bases)
