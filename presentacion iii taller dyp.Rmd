---
title: "Modeling PHQ-9 Scores in Chilean Longitudinal Social Survey"
author: "Carlos Delgado G."
date: "13-11-2021"
output:
  ioslides_presentation:
    css: css_presentacion.css


---



```{r setup, include=FALSE}
library(tidyverse)
library(data.table)
library(pscl)
knitr::opts_chunk$set(echo = FALSE,message = FALSE,warning = FALSE)
```

```{r}
#Recodificaciones
source('Recodificaciones.R', encoding = 'UTF-8', echo=FALSE)
source('funciones midap.R', encoding = 'UTF-8', echo=FALSE)
```

## About the data

- [ELSOC-COES](https://coes.cl/encuesta-panel/)

```{r}
knitr::include_graphics("imagen_elsoc_coes.png")
```

## About PHQ-9


## PHQ-9 Items (1-3)

Over the last 2 weeks, how often have you been bothered
by any of the following problems? 

```{r}
grafo_phq(c("s11_01_rec","s11_02_rec","s11_03_rec"),c("Little interest in things","Feeling down","Trouble with sleep"))
```

## PHQ-9 Items (4-6)

Over the last 2 weeks, how often have you been bothered
by any of the following problems? 

```{r}
grafo_phq(c("s11_04_rec","s11_05_rec","s11_06_rec"),c("Tired or little energy","Poor appetite or overeating","Feeling bad about yourself"))
```

## PHQ-9 Items (7-9)

Over the last 2 weeks, how often have you been bothered
by any of the following problems? 

```{r}
grafo_phq(c("s11_07_rec","s11_08_rec","s11_09_rec"),c("Trouble concentrating","Moving slowly or restless","Thoughts of hurting yourself"))
```


## Aggregated PHQ-9 score {.smaller}

For each of the 9 items recode "Not at all" as 0, "Several days" as 1, "More than half the days" as 2, and "Nearly everyday" as 3. Then sum all items. The result is a score that ranges from 0 to 27.

```{r}
ggplot(elsoc_2016,aes(x=s11_phq9))+
  geom_bar(fill="cornflowerblue",color="white")+
  labs(title = "Escala de sintomatología depresiva",
       x="PHQ-9 Score",
       y="Frecuency")+
  theme_classic()
```

## Differences in depressive sintoms (1)

```{r}
phq_boxplot("m0_sexo_fac","PHQ-9 Scores by gender",etiq = c("Male", "Female"))
```

## Differences in depressive sintoms (2)

```{r}
phq_boxplot("m02_fac", etiq = c("Employed","Domestic Labour","Retired","Unemployed","Other Categories"))
```

## Differences in depressive sintoms (3)
```{r}
phq_boxplot("s_imc_fac",etiq = c("Normal","Overweight","Obese"))
```

## Differences in depressive sintoms (4)
```{r}
phq_boxplot("s08_fac",etiq = c("Non smoker","Smoker"))
```

## Differences in depressive sintoms (5)
```{r}
phq_boxplot("s01_fac")
```

## Modeling approaches for discrete over-disperse data

- The Poisson Model
- Over disperse data
- Excess of ceros
- We want count probabilities

## Zero-inflated Negative Binomial (ZINB) Regression

- You model two separate processes

## Modeling PHQ-9 Scores by ZINB regression {.reduced}


```{r}
mod_zinb<- zeroinfl(s11_phq9~s_imc+m0_sexo_fac+s13_estresores+m0_edad+s01_fac+s08_fac,data = elsoc_2016,dist="negbin")

```

```{r,results='asis',fig.height=5}
texreg::htmlreg(mod_zinb,single.row=TRUE,
                custom.coef.names=c("Count: Intercepto","Count: IMC","Count: Mujer","Count: Estresores",
                                                             "Count: Edad","Count: Satisfacción Neutra","Count: Satisfacción Positiva",
                                                             "Count: Fumador","Count: Theta",
                                                             "Zero: Intercepto","Zero: IMC","Zero: Mujer","Zero: Estresores",
                                                             "Zero: Edad","Zero: Satisfacción Neutra","Zero: Satisfacción Positiva",
                                                             "Zero: Fumador"),
                custom.model.name="Zero-Inflated Negative Binomial Regression")
```

## Coefficients Interpretation {.smaller}

```{r}
exp_coef<- exp(coefficients(mod_zinb))
tabla_coef <- tibble("Variable"=unique(gsub(x=names(exp_coef),pattern = "count_|zero_",replace="")),
       "Conteo"=matrix(exp(coefficients(mod_zinb)),ncol = 2)[,1],
       "Zero"=matrix(exp(coefficients(mod_zinb)),ncol = 2)[,2])
tabla_coef$Variable <- c("Intercept","BMI","Female","Stressors","Age","Neutral Satisfaction","Positive Satisfaction","Smoker")
  
knitr::kable(tabla_coef)
```

## Count Effects in PHQ-9 Scores

```{r}
grafo_eff("Conteo")
```

## Zero effects in PHQ-9 Scores

```{r}
grafo_eff("Zero")
```

## What does that mean? Count part

## What does that mean? Zero part

## Future directions

## I'm happy to hear about

- Applications of PHQ-9
- Faactor in depressive sintoms
- Mental Health in Chile (Specially data bases)
